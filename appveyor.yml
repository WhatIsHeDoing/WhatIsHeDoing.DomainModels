version: 1.0.{build}
image: Visual Studio 2017
platform: Any CPU
environment:
  SNYK_KEY:
    secure: 3Veu6SjQ3EG4CsnWwZC2/Tb5ckd2T9ym1wcCEzYnLcDiVO/4looeNn/pEMElOxbw
before_build:
- choco install opencover.portable
- choco install codecov
build_script:
- dotnet restore
- dotnet build --configuration Release
after_build:
- npm install lodash snyk -g
- snyk auth %SNYK_KEY%
- cd WhatIsHeDoing.DomainModels
#- snyk test
#- snyk monitor
test_script:
- ps: dotnet test --configuration Release WhatIsHeDoing.DomainModels.Tests
- OpenCover.Console.exe -register:user -target:"C:/Program Files/dotnet/dotnet.exe" -targetargs:test -filter:"+[WhatIsHeDoing.DomainModels*]* -[WhatIsHeDoing.DomainModels.Tests]*" -output:coverage.xml -oldstyle
- codecov -f coverage.xml
artifacts:
  - path: 'WhatIsHeDoing.DomainModels\bin\Release\WhatIsHeDoing.DomainModels.*.nupkg'
    name: WhatIsHeDoing.DomainModels NuGet package
    type: NuGetPackage
deploy:
  provider: NuGet
  api_key:
    secure: 0vvD9xkaKen4fUz/3PIi0hbKx6Nyggnvlv8/EOyMtzG/t9T4h/3pdJQJQGa9Tf1z
  skip_symbols: false
  artifact: /.*\.nupkg/
